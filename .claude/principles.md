# 核心原则（每次会话必读）

## 绝对禁止
1. **禁止擅自修改交易逻辑** - 任何涉及下单、风控、决策的代码修改必须先获得用户明确同意
2. **禁止跳过安全检查** - 不能删除或绕过 `confirm=False`、`--dry-run`、风控熔断等安全机制
3. **禁止自作主张** - 不确定的事情问用户，不要猜测后直接执行
4. **禁止删减功能** - 不能以"优化"、"简化"为借口删除或改变原有交易功能
5. **禁止直接实盘测试** - 任何代码变更必须先在测试模式/模拟盘验证

## 必须遵守
1. 发现问题 → 报告给用户 → 等用户决定怎么处理
2. 有多种方案 → 列出选项（包括风险评估）→ 让用户选择
3. 要改代码 → 先说明要改什么及可能影响 → 用户同意后再改
4. **财务操作三次确认** - 涉及真实资金的操作必须明确提示风险

---

## 代码实现必须遵守 CLAUDE.md

**写代码前必须读 `CLAUDE.md`，严格遵守其中的规范。**

以下是核心要点速查：

### 绝对禁止

#### 安全相关
- ❌ **跳过安全机制**: 不能删除 `confirm=False`、`dry_run=True`、风控检查
- ❌ **硬编码敏感信息**: 账号、密码必须使用环境变量或配置文件
- ❌ **直接修改风控参数**: 止损、止盈、熔断阈值必须在配置文件修改，不能硬编码
- ❌ **绕过交易时间检查**: 不能删除或修改交易时间限制逻辑

#### 代码质量
- ❌ **垃圾注释**: `# TODO`、`# FIXME`、`# 临时`、无意义的注释
- ❌ **临时文件**: `test_temp.py`、`debug.py`、`*.bak`、未提交的调试文件
- ❌ **空异常捕获**: `except: pass` 或 `except Exception: pass` 吞错误
- ❌ **硬编码配置**: 所有阈值、API地址、路径必须在配置文件中

#### GUI自动化
- ❌ **减少延迟**: 不能随意减少 `time.sleep()` 或 `pyautogui.PAUSE` - GUI需要时间响应
- ❌ **跳过坐标校准**: 新UI元素必须校准坐标后才能使用
- ❌ **忽略窗口管理**: 必须确保THS窗口激活且在前台

#### 量化系统
- ❌ **直接修改决策权重**: 决策引擎权重必须在 `config_quant.py` 配置
- ❌ **跳过风控检查**: RiskManager 的检查不能被绕过
- ❌ **修改模型评分逻辑**: 模型分数解读逻辑不能随意修改

### 必须遵守

#### 安全第一
- ✅ **默认安全模式**: 新功能默认 `confirm=False` 和 `dry_run=True`
- ✅ **完整错误处理**: 所有交易操作必须有 try-except 和日志记录
- ✅ **操作可追溯**: 所有交易决策和操作必须记录到日志
- ✅ **风险提示**: 在关键操作前给出明确的风险警告

#### 代码质量
- ✅ **使用 logger**: 用 `logging` 模块替代 `print()`
- ✅ **类型提示**: 函数参数和返回值添加类型注解
- ✅ **文档字符串**: 关键函数必须有清晰的 docstring
- ✅ **命名规范**: 函数/变量名准确反映功能，避免缩写

#### GUI自动化
- ✅ **坐标校准**: 新UI元素添加到 `coords_relative` 并校准
- ✅ **延迟保护**: 尊重现有的延迟设置，确保GUI稳定
- ✅ **窗口检查**: 操作前检查THS窗口状态
- ✅ **剪贴板输入**: 中文输入使用剪贴板方法

#### 量化系统
- ✅ **配置文件管理**: 所有参数在 `config_quant.py` 集中管理
- ✅ **模块化运行**: 使用 `python3 -m quant_system.xxx` 模块语法
- ✅ **测试优先**: 新策略必须先在测试模式验证
- ✅ **日志完整**: 关键决策点必须记录到日志

#### 测试与部署
- ✅ **三步测试**: Mock数据 → Dry-run → 小仓位实盘
- ✅ **坐标验证**: GUI修改后必须用 `calibrate_helper.py` 验证
- ✅ **代码审查**: 交易逻辑修改必须仔细审查
- ✅ **文档同步**: 重要功能修改必须更新相关文档

---

## 🚨 财务安全特别提示

本项目涉及真实资金操作，任何代码错误都可能导致财务损失：

1. **永远不要在未测试的情况下使用真实资金**
2. **修改交易逻辑前必须通过模拟盘验证**
3. **任何风控参数修改必须经过严格测试**
4. **出现异常时立即停止交易并人工介入**
5. **定期检查交易记录和日志文件**

## 开发者责任声明

作为开发者/AI助手，你必须：
- 明确告知用户任何修改可能带来的风险
- 优先保护资金安全，其次才是功能优化
- 不能以"提高效率"为由降低安全标准
- 遇到不确定的情况时，选择更保守的方案
