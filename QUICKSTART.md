# 快速开始指南

## 问题诊断：输入到了错误的位置？

如果你遇到"执行test.py时输入内容到了顶部搜索框而不是交易面板"的问题，请按照以下步骤解决：

---

## 🚀 三步快速修复

### 第一步：运行校准工具

```bash
python3 calibrate_helper.py
```

选择选项 `1` 开始校准。

### 第二步：按提示校准坐标

程序会要求你将鼠标移动到以下6个位置：
1. 买入按钮
2. 卖出按钮
3. 股票代码输入框
4. 价格输入框
5. 数量输入框
6. 确定按钮

每次移动鼠标到目标位置后，在**终端**按 Enter 键确认。

### 第三步：复制配置代码

校准完成后，程序会生成配置代码，类似：

```python
self.coords_relative = {
    'buy_button': (271, 90),
    'sell_button': (329, 90),
    'code_input': (280, 140),
    'price_input': (280, 175),
    'quantity_input': (280, 212),
    'confirm_button': (305, 258),
}
```

将这段代码复制到 `ths_mac_trader.py` 文件中，替换现有的 `self.coords_relative` 配置（大约在第61-76行）。

---

## ✅ 验证修复

运行测试：

```bash
python3 test.py
```

你应该看到类似输出：

```
==================================================
准备下单: 买入 603993
价格: 24.33, 数量: 100
==================================================
  → 窗口位置: (100, 200), 大小: (800x600)
切换交易方向...
  → 点击位置: (371, 290)
输入股票代码: 603993
  → 点击位置: (380, 340)
...
```

观察：
- ✅ 窗口位置信息正确显示
- ✅ 点击位置在合理范围内
- ✅ 输入内容到了正确的输入框（不是搜索框）

---

## 🎯 原理说明

### 为什么会输入到错误位置？

原因是代码中的坐标是**示例值**，需要根据你的屏幕进行校准。不同的：
- 屏幕分辨率
- 窗口大小
- 窗口位置

都会导致坐标不准确。

### 新版本的改进

最新版本引入了**相对坐标模式**：

**旧方法（绝对坐标）**：
```
点击位置 = (280, 140)  # 固定坐标，移动窗口就失效
```

**新方法（相对坐标）**：
```
点击位置 = 窗口左上角 + (280, 140)  # 自动适应窗口位置
```

这样即使移动窗口，坐标仍然有效！

---

## 📋 详细配置说明

### 相对坐标模式（推荐）

在 `ths_mac_trader.py` 中配置：

```python
def __init__(self):
    # 相对坐标（相对于窗口左上角）
    self.coords_relative = {
        'buy_button': (271, 90),      # 你的坐标
        'sell_button': (329, 90),     # 你的坐标
        'code_input': (280, 140),     # 你的坐标
        'price_input': (280, 175),    # 你的坐标
        'quantity_input': (280, 212), # 你的坐标
        'confirm_button': (305, 258), # 你的坐标
    }

    self.coords = self.coords_relative.copy()
    self.use_relative_coords = True  # 启用相对坐标
```

### 绝对坐标模式（备选）

如果相对坐标模式不工作，可以使用绝对坐标：

```python
def __init__(self):
    # 绝对坐标（相对于整个屏幕）
    self.coords = {
        'buy_button': (500, 300),     # 你的绝对坐标
        'sell_button': (558, 300),
        # ... 其他坐标
    }

    self.use_relative_coords = False  # 禁用相对坐标
```

⚠️ **注意**：绝对坐标模式下，必须保持窗口位置固定！

---

## 🔧 常用工具

### 1. 校准工具

```bash
python3 calibrate_helper.py
```

功能：
- 选项1：开始校准（推荐）
- 选项2：测试坐标
- 选项3：实时鼠标位置

### 2. 测试脚本

```bash
python3 test.py
```

用于测试配置是否正确。

### 3. 实时鼠标位置

```bash
python3 calibrate_helper.py
# 选择选项 3
```

实时显示鼠标坐标，帮助你手动记录位置。

---

## 🛠️ 故障排除

### 问题1：窗口位置无法获取

**症状**：
```
⚠️ 无法获取窗口位置，将使用绝对坐标
```

**解决**：
1. 确认同花顺应用名称是"同花顺"
2. 检查辅助功能权限（系统偏好设置 → 安全性与隐私 → 辅助功能）
3. 尝试使用绝对坐标模式

### 问题2：点击位置不准确

**解决**：
1. 重新运行校准工具
2. 确保校准时窗口位置与使用时一致
3. 检查是否有屏幕缩放设置

### 问题3：输入内容失败

**解决**：
1. 确认输入法是英文模式
2. 增加延迟时间：`pyautogui.PAUSE = 0.5`
3. 检查是否有安全软件拦截

详细故障排除请查看：[TROUBLESHOOTING.md](./TROUBLESHOOTING.md)

---

## 📚 进阶使用

### 自定义延迟

如果操作太快导致失败，可以调整延迟：

```python
import pyautogui
pyautogui.PAUSE = 0.5  # 从默认的0.3增加到0.5秒

from ths_mac_trader import THSMacTrader
trader = THSMacTrader()
trader.buy("603993", price=24.33, quantity=100)
```

### 批量下单

```python
from ths_mac_trader import THSMacTrader
import time

trader = THSMacTrader()

orders = [
    ("600000", 10.5, 100, "buy"),
    ("603993", 24.33, 100, "buy"),
]

for code, price, qty, direction in orders:
    trader.buy(code, price, qty, confirm=False)
    time.sleep(2)  # 每单间隔2秒
```

### 调试模式

查看详细的点击位置信息：

```python
from ths_mac_trader import THSMacTrader

trader = THSMacTrader()
# 程序会自动输出点击位置信息
trader.buy("603993", price=24.33, quantity=100)
```

输出示例：
```
→ 窗口位置: (100, 200), 大小: (800x600)
切换交易方向...
  → 点击位置: (371, 290)
输入股票代码: 603993
  → 点击位置: (380, 340)
```

---

## ⚠️ 安全提示

1. **先用模拟盘测试** - 确认所有操作正确后再用于实盘
2. **手动确认** - 建议使用 `confirm=False`，最后一步手动确认
3. **设置止损** - 程序可能出错，务必设置券商条件单止损
4. **保持监控** - 不要完全无人值守，定期检查运行状态

---

## 📞 获取帮助

如果以上方法无法解决问题：

1. 查看详细故障排除文档：[TROUBLESHOOTING.md](./TROUBLESHOOTING.md)
2. 运行诊断工具记录详细信息
3. 检查 README.md 了解更多使用说明

---

## ✨ 小贴士

- 🎯 校准时确保同花顺窗口完全显示
- 🖱️ 将鼠标放在按钮/输入框的**中心位置**
- ⏱️ 如果操作失败，尝试增加延迟时间
- 🔄 更改屏幕分辨率或窗口大小后需要重新校准
- 💾 保存好校准后的配置代码，以备后用
